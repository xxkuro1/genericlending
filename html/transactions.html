<!DOCTYPE html>

<html>



	<head>
	<link rel="stylesheet" type="text/css" href="../css/style.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"> </script>
	<!-- Compiled and minified CSS -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
	<!-- Compiled and minified JavaScript -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
        <link href="../css/skeleton.css" rel="stylesheet" type="text/css">
        <link href="../css/normalize.css" rel="stylesheet" type="text/css">
	</head>
	<style>
        td, th {
            border: 1px solid #dddddd;
            text-align: center;
            padding: 8px;

        }


        table {
            font-family: arial, sans-serif;
            border-collapse: collapse;
            width: 100%;
        }

	</style>

	<body>

		 <iframe id="header-iframe" src="headerloan.html" scrolling="no"></iframe>
	<div class="search" align="center">

    	

		<br>
		<form>
			<input class="inputsearch" id="inputsearch" name="search" onkeyup="filterTable()" type="text"><br>

		</form>


	</div>

				<div class="table">

					<div class="somemodal" align="center">
						<!--- MODAL BODY -->
						<div id="modal1" class="modal">
							<div class="modal-content">

									<label>Transaction ID </label>
									<input type="number" id="tid" class="inputfield u-full-width" placeholder="Transaction ID" readonly><br>
									<label>First Name: </label>
									<input type="text" id="fname" class="inputfield u-full-width" placeholder="First Name"><br>
									<label>Last Name: </label>
									<input type="text" id="lname"  class="inputfield u-full-width" placeholder="Last Name">
									<label>Address: </label>
									<textarea class="inputfield u-full-width" id="address" placeholder="Address"
											  type="text"></textarea><br><br>
								<label>Loan Interest (percent) </label>
								<input class="inputfield u-full-width" id="loaninterest" placeholder="10" readonly type="number" value="10">
								<label>Amount</label>
								<input type="number" id="amount" class="inputfield u-full-width" placeholder="Amount" >

								<label>Term of Payment (per year) </label>
								<select id="termofpayment" class="payment browser-default inputfield" required>
									<option value=1>1</option>
									<option value=2>2</option>
									<option value=3>3</option>
									<option value=4>4</option>
									<option value=5>5</option>
									<option value=6>6</option>
									<option value=7>7</option>
									<option value=8>8</option>
									<option value=9>9</option>
									<option value=10>10</option>
								</select><br>

								<label>Total paid with Interest (with Interest)</label>
								<input class="inputfield" id="totalpaid" readonly type="number">

								<label>Monthly Pay(With Interest)</label>
								<input class="inputfield" id="monthlypaid" readonly type="number">
								<br><br>
								<label>Due Date</label>
								<input type="date" id="duedate" class="inputfield"><br><br>
								<input type="button"  class="button button-primary btnAdd" onclick="insertData('insert')" id="btnAdd"  value="Add Transactions">
							</div>
							<div class="modal-footer">
								<a href="#!" class="modal-close waves-effect waves-green btn-flat">Save</a>
								<a href="#!" class="modal-close waves-effect waves-red btn-flat">Cancel</a>
							</div>
						</div>
					</div>

                    <table id="tableID" width="50%">
                        <thead>
                        <tr  class="thcolor">
                            <th>Transaction ID</th>
                            <th>FirstName</th>
                            <th>LastName</th>
                            <th>Address</th>
                            <th>Actions</th>
                        </tr>
                        <tbody id="tablebody">

                        </tbody>
                        </thead>

                    </table>
			</div>
	</body>
    <script type="text/javascript">
        $(document).ready(function () {
            $.ajax({
                url: "../php/view.php",
                type: "POST",
                cache: false,
                success: function (response) {
                    //alert(response);
                    $("#tablebody").html(response);
                }
            });
			$(document).ready(function(){
				$('.modal').modal();
			});
        });



        function viewData(id, type) {
            $.ajax({
                url: "../php/viewdata.php",
                method: "POST",
				dataType:"json",
                data: {
                    key: "view",
                    id: id
                },
                cache: false,
                success: function (response) {
                	alert(type)
					if(type == "view"){
						$("#tid").val(response.tid);
						$("#fname").val(response.fname);
						$("#lname").val(response.lname);
						$("#address").val(response.address);
						$("#amount").val(response.amount);
						$("#termofpayment").val(response.top);
						$("#totalpaid").val(response.tp);
						$("#monthlypaid").val(response.mp);
						$("#duedate").val(response.dd);

					}
                }
            });
        }

        function deleteData(id) {
            let inputsearch = $("#inputsearch");
            inputsearch.val();
            $.ajax({
                url: "../php/delete.php",
                type: "POST",
                data: {
                    key: "delete",
                    id: id
                },
                cache: false,
                success: function (response) {
                    alert(response);
                    $("#transaction_id_" + id).parent().remove();
                }
            });

        }
		

        //Data Table alternative (requested by sir tan)
        function filterTable() {
            // ES declarations
            let input, filter, table, tr, td, i, txtval;
            input = document.getElementById("inputsearch");
            filter = input.value.toUpperCase();
            table = document.getElementById("tablebody");
            tr = table.getElementsByTagName("tr");

            //loop through the rows
            for (i = 0; i < tr.length; i++) {
                td = tr[i].getElementsByTagName("td")[1];
                if (td) {
                    txtval = td.textContent || td.innerText;
                    if (txtval.toUpperCase().indexOf(filter) > -1) {
                        tr[i].style.display = "";
                    } else {
                        tr[i].style.display = "none";
                    }
                }
            }
        }



		let amountevent = document.getElementById('amount');
		let topevent = document.getElementById("termofpayment");

		amountevent.addEventListener('input', (event) => {
			let amount = Number(document.getElementById("amount").value);
			let interest = Number(document.getElementById("loaninterest").value);
			let year = Number(document.getElementById("termofpayment").value);
			let interest1 = (Number(amount)*Number(interest)*Number(year))/100;

			let total = amount + interest1;
			let emi = total/(year*12);
			document.getElementById("totalpaid").value = total;
			document.getElementById("monthlypaid").value = emi;
		});

		topevent.addEventListener('change', (event) => {
			let amount = Number(document.getElementById("amount").value);
			let interest = Number(document.getElementById("loaninterest").value);
			let year = Number(document.getElementById("termofpayment").value);
			let interest1 = (Number(amount)*Number(interest)*Number(year))/100;

			let total = amount + interest1;
			let emi = total/(year*12);
			document.getElementById("totalpaid").value = total;
			document.getElementById("monthlypaid").value = emi;
		});
    </script>
	</html>